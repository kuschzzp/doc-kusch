---
title: Docker部署Nginx
date: 2023-05-13 23:09:48
permalink: /pages/9dd079/
categories:
  - 部署与运维
  - Docker部署
tags:
  - docker
author: 
  name: Mr.Kusch
  link: https://github.com/kuschzzp
---

## Docker部署Nginx

### 创建基础的配置文件

创建一个初始化脚本, 创建文件、给予可执行权限，运行脚本，运行docker启动命令。

- `  touch init-nginx.sh  `
- `  chmod +x init-nginx.sh  `

```shell
#!/bin/bash

BASE_DIR=$(pwd)/nginx

echo "📁 创建目录结构..."
mkdir -p $BASE_DIR/etc/nginx/conf.d
mkdir -p $BASE_DIR/html
mkdir -p $BASE_DIR/logs

echo "📝 创建 nginx.conf ..."
cat > $BASE_DIR/etc/nginx/nginx.conf << 'EOF'
user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    access_log  /var/log/nginx/access.log;

    include /etc/nginx/conf.d/*.conf;
}
EOF


echo "📝 创建 conf.d/default.conf ..."
cat > $BASE_DIR/etc/nginx/conf.d/default.conf << 'EOF'
server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
EOF


echo "📝 创建静态首页 index.html ..."
cat > $BASE_DIR/html/index.html << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nginx Docker 部署成功</title>
</head>
<body>
<h1>Nginx 已成功启动！</h1>
<p>这是由 Docker 容器部署的 Nginx，自定义目录挂载。</p>
</body>
</html>
EOF

echo "🎉 基础 Nginx 配置已创建完毕！"
```

### 启动

```shell
docker run -itd \
  --restart=unless-stopped \
  --name nginx \
  -p 80:80 \
  -v $(pwd)/nginx/etc/nginx/nginx.conf:/etc/nginx/nginx.conf \
  -v $(pwd)/nginx/etc/nginx/conf.d:/etc/nginx/conf.d \
  -v $(pwd)/nginx/html:/usr/share/nginx/html \
  -v $(pwd)/nginx/logs:/var/log/nginx \
  nginx:latest
```

> --restart=unless-stopped 自动重启容器（包括服务器重启和容器异常退出），但如果由用户手动停止，则不会自动拉起。是生产环境最常用的重启策略。



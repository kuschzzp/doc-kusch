---
title: DeepAgent之Subagent
date: 2025-12-30 18:57:41
permalink: /pages/d31fc5/
categories:
  - 强大的AI
  - DeepAgent
tags:
  - DeepAgent
author: 
  name: Mr.Kusch
  link: https://github.com/kuschzzp
---


原文地址：[https://docs.langchain.com/oss/python/deepagents/subagents](https://docs.langchain.com/oss/python/deepagents/subagents)


## 一句话先讲清楚 Subagent 是什么

> Subagent = 被主 Agent 调用的“隔离执行单元”
> 用来干复杂、脏、长、专业的活，但不污染主 Agent 的上下文。



## 一、为什么要用 Subagents？（核心动机）

### 1️⃣ 问题：上下文膨胀（Context Bloat）

如果 主 Agent 自己干这些事：

* 连续 10 次 web search
* 读 3 个大文件
* 查数据库、跑分析

👉 所有中间结果都会进主上下文  
👉 很快 token 爆炸  
👉 后续推理质量下降  

### 2️⃣ Subagent 的解决方式

```
主 Agent
  └── 把任务丢给 Subagent
        ├─ 多次搜索
        ├─ 多步分析
        ├─ 内部工具调用
        ↓
      只返回「最终结论」
```

✔ 主 Agent 只看到干净的结果
✔ 中间步骤被“隔离”
✔ 非常适合 Deep Agent 场景

> 这就是文档里说的 Context Quarantine（上下文隔离）



## 二、什么时候该用 / 不该用 Subagent

### ✅ 适合用 Subagent 的场景

* 多步骤任务（搜索 → 分析 → 总结）
* 会大量用工具（web / DB / file）
* 专业分工（研究 / 财务 / 法律 / 代码）
* 你想让主 Agent 只做调度，不做细活

### ❌ 不适合的场景

* 一句话能完成的事
* 你必须保留中间思考链
* 子任务本身很简单（反而增加复杂度）



## 三、Subagent 在 Deep Agent 架构中的位置

画一张脑图 👇

```
User
 ↓
Main Agent（create_deep_agent）
 ├─ tools
 ├─ memory / store
 ├─ checkpointer
 └─ subagents
      ├─ research-agent
      ├─ code-agent
      └─ general-purpose（默认存在）
```

⚠️ 关键点：

* Subagent ≠ Tool
* Subagent 是 Agent inside Agent
* 主 Agent 通过 `task()` 调用它



## 四、SubAgent（字典形式）逐字段教学

这是最常用、90% 场景用这个 👇

```python
research_subagent = {
    "name": "research-agent",
    "description": "Used to research more in depth questions",
    "system_prompt": "You are a great researcher",
    "tools": [internet_search],
    "model": "openai:gpt-4o",
}
```

### 1️⃣ name（必须）

```python
"name": "research-agent"
```

* 唯一标识
* 主 Agent 调用时用的名字
* 类似函数名



### 2️⃣ description（非常非常重要）

```python
"description": "Used to research more in depth questions"
```

🚨 这是主 Agent 判断“要不要用它”的依据

好 vs 坏对比：

```python
# ✅ 好
"Conducts in-depth research using multiple web searches and synthesis"

# ❌ 坏
"helps with stuff"
```

👉 如果你发现 Subagent 从不被调用，80% 是这里写得不清楚



### 3️⃣ system_prompt（给子专家的“角色说明书”）

```python
"system_prompt": """
你是一个严谨的研究员：
1. 拆解问题
2. 搜索
3. 综合结论
4. 只返回总结
"""
```

你必须在这里明确规定：

* 能做什么
* 不能返回什么
* 输出格式
* 字数限制

👉 否则上下文还是会被撑爆



### 4️⃣ tools（只给必要的）

```python
"tools": [internet_search]
```

原则：

> 子代理 = 专用工种

❌ 错误示范：

```python
tools=[web, db, email, fs, calc]
```

✅ 正确示范：

```python
tools=[internet_search]
```



### 5️⃣ model（可选）

```python
"model": "openai:gpt-4o"
```

含义：
这个 Subagent 用什么模型跑

常见策略：

| 场景   | 模型     |
| ---- | ------ |
| 长文档  | Claude |
| 数值分析 | GPT    |
| 快速处理 | 小模型    |



## 五、CompiledSubAgent 是什么时候用的？

> 当 Subagent 本身就是一个“复杂流程图”

### 对比理解

| 类型               | 适用         |
| ---------------- | ---------- |
| dict SubAgent    | 单轮 / 轻逻辑   |
| CompiledSubAgent | 多节点 / 状态流转 |

例子：

* 多步审批流程
* 分支判断
* LangGraph 状态机

```python
CompiledSubAgent(
    name="data-analyzer",
    runnable=custom_graph
)
```

👉 本质：Subagent = 一个完整 LangGraph



## 六、隐藏王牌：general-purpose Subagent

> 默认存在，不用你定义

特性：

* 和主 Agent：

    * 同 system_prompt
    * 同 tools
    * 同 model
* 但：上下文隔离

### 什么时候用它？

当你想：

* 隔离一坨复杂步骤
* 但不想再定义一个新 Subagent

```python
task(
  name="general-purpose",
  task="Research quantum computing trends"
)
```




## 七、最佳实践（你一定会踩的坑）

### ❌ 坑 1：Subagent 不被调用

原因：

* description 不清晰
* 主 Agent 没被要求“多用 Subagent”

解决：

```python
system_prompt = """
你是一个调度型 Agent。
复杂任务 必须 委托给 subagents。
"""
```



### ❌ 坑 2：上下文还是爆了

原因：

* Subagent 返回了原始数据

解决：

```python
system_prompt = """
只返回总结：
- 不要 raw data
- 不要搜索结果
- 不要中间步骤
"""
```



### ❌ 坑 3：Subagent 职责重叠

解决：description 要像接口文档一样精确

```python
"用于 1-2 次搜索的快速查询"
"用于 10+ 次搜索的深度研究"
``` 
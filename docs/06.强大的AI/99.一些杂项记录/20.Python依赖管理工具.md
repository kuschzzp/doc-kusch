---
title: Python依赖管理工具
date: 2026-01-20 10:46:07
permalink: /pages/69b776/
categories:
  - 强大的AI
  - 一些杂项记录
tags:
  - python
author: 
  name: Mr.Kusch
  link: https://github.com/kuschzzp
---
# Python 依赖管理工具

## 工具演进时间线

```
2008 ─────────── 2016 ─────── 2018 ─────── 2024
  │                │            │            │
  pip          pyproject.toml  Poetry       uv
  │                │            │            │
  └─ requirements.txt           └─ poetry.lock
                                             └─ uv.lock
```



## pip + requirements.txt（传统方式，2008年）

### 工作原理

```bash
# 安装依赖
pip install requests flask

# 导出依赖列表
pip freeze > requirements.txt

# 从文件安装
pip install -r requirements.txt
```

### requirements.txt 示例

```
requests==2.31.0
flask==3.0.0
click==8.1.7
```

### 优缺点

**优点**：
- ✅ 简单直接
- ✅ 所有人都会用
- ✅ 兼容性最好

**缺点**：
- ❌ 没有区分"直接依赖"和"间接依赖"
- ❌ 没有锁定机制（不同时间安装可能得到不同版本）
- ❌ 无法管理开发依赖和生产依赖
- ❌ 无法管理项目元数据（版本、作者等）



## pip + setup.py（改进版，2000年代）

### setup.py 示例

```python
from setuptools import setup

setup(
    name="myproject",
    version="1.0.0",
    install_requires=[
        "requests>=2.20.0",
        "flask>=3.0.0",
    ],
    extras_require={
        "dev": ["pytest", "black"],
    }
)
```

### 安装方式

```bash
# 安装项目
pip install -e .

# 安装开发依赖
pip install -e ".[dev]"
```

### 改进与问题

**改进**：
- ✅ 区分了直接依赖和间接依赖
- ✅ 可以定义额外依赖（dev、test等）
- ✅ 包含项目元数据

**仍然的问题**：
- ❌ 没有锁定文件
- ❌ setup.py 是 Python 代码，不够声明式



## pyproject.toml（现代标准，PEP 518，2016年）

### pyproject.toml 示例

```toml
[project]
name = "myproject"
version = "1.0.0"
dependencies = [
    "requests>=2.20.0",
    "flask>=3.0.0",
]

[project.optional-dependencies]
dev = ["pytest", "black"]
```

### 安装方式

```bash
# pip 可以直接读取 pyproject.toml
pip install -e .
pip install -e ".[dev]"
```

### 优缺点

**优点**：
- ✅ 声明式配置（TOML 格式）
- ✅ Python 官方标准（PEP 518）
- ✅ 所有现代工具都支持

**仍然的问题**：
- ❌ 单独使用 pip 仍然没有锁定文件



## Poetry（完整解决方案，2018年）

### 文件结构

```
pyproject.toml    # 定义依赖（你写的）
poetry.lock       # 锁定精确版本（Poetry 生成的）
```

### pyproject.toml（Poetry 格式）

```toml
[tool.poetry]
name = "myproject"
version = "1.0.0"

[tool.poetry.dependencies]
python = "^3.9"
requests = "^2.20.0"
flask = "^3.0.0"

[tool.poetry.group.dev.dependencies]
pytest = "^7.0.0"
black = "^23.0.0"
```

### 常用命令

```bash
# 初始化项目
poetry init

# 添加依赖
poetry add requests

# 添加开发依赖
poetry add --group dev pytest

# 安装所有依赖
poetry install

# 运行命令
poetry run python script.py

# 激活虚拟环境
poetry shell
```

### poetry.lock 的作用

```
requests==2.31.0
  ├── charset-normalizer==3.3.2
  ├── idna==3.6
  ├── urllib3==2.1.0
  └── certifi==2023.11.17
```

- 记录了每个包的**精确版本**
- 记录了所有**间接依赖**
- 保证团队成员安装的版本完全一致

### 优缺点

**优点**：
- ✅ 有锁定文件（确定性构建）
- ✅ 自动管理虚拟环境
- ✅ 依赖解析更智能
- ✅ 打包和发布功能

**缺点**：
- ❌ 需要额外安装 Poetry
- ❌ 学习曲线稍高
- ❌ 速度较慢



## uv（新一代工具，2024年）

### 特点

- 🚀 用 Rust 编写，速度比 pip 快 10-100 倍
- 🔒 有锁定文件（uv.lock）
- 📦 兼容 pyproject.toml
- 🎯 目标是替代 pip、pip-tools、poetry、virtualenv

### uv.lock 示例

```toml
version = 1
requires-python = ">=3.9"

[[package]]
name = "requests"
version = "2.31.0"
dependencies = [
    { name = "charset-normalizer" },
    { name = "idna" },
]
```

### 常用命令

```bash
# 创建虚拟环境
uv venv

# 安装依赖
uv pip install -r requirements.txt

# 同步依赖（根据 pyproject.toml）
uv sync

# 添加依赖
uv add requests
```

### 优缺点

**优点**：
- ✅ 极快的速度
- ✅ 有锁定文件
- ✅ 兼容现有生态

**缺点**：
- ❌ 还很新（2024年）
- ❌ 生态系统还在发展



## 工具兼容性矩阵

| 文件格式 | pip | Poetry | uv |
|---------|-----|--------|-----|
| **pyproject.toml** | ✅ | ✅ | ✅ |
| **poetry.lock** | ❌ | ✅ | ❌ |
| **uv.lock** | ❌ | ❌ | ✅ |
| **requirements.txt** | ✅ | ✅ | ✅ |

### 说明

- **pyproject.toml**：现代标准，所有工具都支持
- **poetry.lock**：Poetry 专用锁定文件
- **uv.lock**：uv 专用锁定文件
- **requirements.txt**：传统格式，通用兼容



## 核心概念

### 1. 锁定文件的重要性

**没有锁定文件的问题**：

```
你的电脑（1月1日）：requests==2.31.0
同事的电脑（2月1日）：requests==2.32.0  # 新版本发布了
→ 可能出现"在我电脑上能跑"的问题
```

**有锁定文件的好处**：

```
poetry.lock 记录：requests==2.31.0
所有人安装：requests==2.31.0
→ 确保环境一致
```

### 2. 直接依赖 vs 间接依赖

```
你的项目
  └── requests (直接依赖，你主动安装的)
       ├── urllib3 (间接依赖，requests 需要的)
       ├── certifi (间接依赖)
       └── charset-normalizer (间接依赖)
```

**不同工具的处理方式**：

- **requirements.txt**：混在一起，分不清
- **pyproject.toml**：只写直接依赖
- **poetry.lock / uv.lock**：记录所有依赖的精确版本

### 3. 版本约束语法

```toml
# Poetry 语法
requests = "^2.20.0"   # >=2.20.0, <3.0.0
requests = "~2.20.0"   # >=2.20.0, <2.21.0
requests = ">=2.20.0"  # 大于等于 2.20.0
requests = "2.20.0"    # 精确版本

# pip 语法
requests>=2.20.0       # 大于等于
requests==2.20.0       # 精确版本
requests>=2.20.0,<3.0.0  # 范围
```



## 实际应用场景

### 场景 1：个人小项目

```bash
# 使用 pip + requirements.txt
pip install requests flask
pip freeze > requirements.txt
```

**适用**：快速原型、学习项目



### 场景 2：团队协作项目

```bash
# 使用 Poetry（推荐）
poetry init
poetry add requests flask
poetry add --group dev pytest

# 提交到 Git
git add pyproject.toml poetry.lock
git commit -m "Add dependencies"
```

**适用**：需要确保团队环境一致的项目



### 场景 3：追求极致性能

```bash
# 使用 uv
uv init
uv add requests flask

# 提交到 Git
git add pyproject.toml uv.lock
git commit -m "Add dependencies"
```

**适用**：大型项目、CI/CD 需要快速安装



### 场景 4：开源项目（兼容性优先）

```bash
# 同时提供多种方式
项目结构：
├── pyproject.toml      # 主要配置（所有工具都能读）
├── poetry.lock         # Poetry 用户
├── requirements.txt    # pip 用户
└── README.md          # 说明各种安装方式
```

**适用**：需要照顾不同用户习惯的开源项目



## 快速参考表

### 安装依赖

| 工具 | 命令 |
|------|------|
| pip | `pip install -r requirements.txt` |
| pip (pyproject.toml) | `pip install -e .` |
| Poetry | `poetry install` |
| uv | `uv sync` |

### 添加新依赖

| 工具 | 命令 |
|------|------|
| pip | `pip install requests` |
| Poetry | `poetry add requests` |
| uv | `uv add requests` |

### 添加开发依赖

| 工具 | 命令 |
|------|------|
| pip | `pip install -e ".[dev]"` |
| Poetry | `poetry add --group dev pytest` |
| uv | `uv add --dev pytest` |

### 导出依赖列表

| 工具 | 命令 |
|------|------|
| pip | `pip freeze > requirements.txt` |
| Poetry | `poetry export -f requirements.txt` |
| uv | `uv pip freeze > requirements.txt` |



## 常见问题

### Q1: 为什么项目里有多个依赖文件？

**答**：为了兼容不同用户的习惯：
- `pyproject.toml`：现代标准，主要配置
- `poetry.lock`：给 Poetry 用户
- `requirements.txt`：给传统 pip 用户
- `uv.lock`：给 uv 用户

### Q2: 我应该用哪个工具？

**答**：
- **个人项目**：pip + requirements.txt
- **团队项目**：Poetry（稳定）或 uv（快速）
- **开源项目**：提供多种方式

### Q3: 锁定文件要提交到 Git 吗？

**答**：
- **应用项目**：✅ 要提交（确保部署环境一致）
- **库项目**：❌ 不提交（让用户自己解析依赖）

### Q4: pip 能读取 poetry.lock 吗？

**答**：❌ 不能。但 pip 可以读取 `pyproject.toml`。如果需要用 pip 安装 Poetry 项目：

```bash
pip install -e .
```

### Q5: 如何从 Poetry 迁移到 uv？

**答**：
```bash
# uv 可以直接读取 pyproject.toml
uv sync

# 会生成新的 uv.lock
```

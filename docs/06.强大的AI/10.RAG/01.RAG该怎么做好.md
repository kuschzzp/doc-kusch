---
title: RAG该怎么做好
date: 2024-11-10 15:09:35
permalink: /pages/45b980/
categories:
  - 强大的AI
  - RAG
tags:
  - AI
author:
  name: Mr.Kusch
  link: https://github.com/kuschzzp
---

## RAG

RAG（Retrieval-Augmented Generation，检索增强生成） 是一种通过从外部知识库检索信息来增强大型语言模型（LLM）的技术，
让 AI 在回答问题时 "先查资料再回答"，从而避免 "一本正经地胡说八道"。

基于我搜集到的最新信息，我来为您全面解释RAG技术及其相关内容。

## 一、RAG的基本概念和工作流程

**RAG（Retrieval-Augmented Generation，检索增强生成）**
是一种通过从外部知识库检索信息来增强大型语言模型（LLM）的技术，让AI在回答问题时"先查资料再回答"，从而避免"
一本正经地胡说八道"。

### 核心工作流程

RAG的基本流程分为三个核心步骤：

1. 检索（Retrieval）
    - 用户提出问题（Query）
    - RAG系统使用检索器从外部知识库中检索相关信息
    - 知识库可以是向量数据库、文本数据库等

2. 增强（Augmentation）
    - 将检索到的相关信息与用户问题相结合
    - 形成增强的Prompt，包含问题和背景知识

3. 生成（Generation）
    - 将增强Prompt输入LLM
    - LLM参考检索到的知识生成最终答案

#### 1. 文本预处理优化

- 实体解析：消除术语歧义，标准化表述（如"LLM"、"大语言模型"统一）
- 文档划分：合理组织不同主题的文档
- 数据增强：使用同义词、释义增加知识库多样性
- 元数据增强：添加摘要、时间戳、潜在问题等信息

#### 2. 高级分块策略

- 递归分割：根据内容复杂度动态调整块大小
- 语义分割：基于向量相似度进行语义层面分割
- 特殊结构分割：针对Markdown、LaTex等格式的专门处理
- 句分割：使用NLTK或spaCy进行句子级分割

#### 3. 嵌入优化

- 动态嵌入：使用BERT等模型处理一词多义
- 微调嵌入：针对垂直领域优化嵌入模型
- 混合嵌入：对问题和知识库使用不同嵌入模型

#### 4. 查询优化技术

- 查询重写：通过LLM优化用户查询表述
- 后退提示：生成抽象通用问题辅助检索
- FollowUp Questions：处理对话历史依赖问题
- HyDE：生成假设性答案增强检索相关性
- 多问题查询：从多角度生成子问题

#### 5. 检索策略优化

- 上下文压缩：过滤无关信息，提高效率
- 句子窗口搜索：扩展上下文范围
- 父文档搜索：两级文档结构提升召回率
- 混合检索：结合向量检索+关键词检索
- 路由机制：根据问题类型选择合适索引
- Agent驱动检索：智能决定检索策略

#### 6. 2025年的前沿趋势RAG

多模态RAG：支持文本、图像、视频的统一检索

- MRAG 3.0架构：引入文档截图，最小化信息损失
- 统一向量表示：CLIP-ViT、BLIP-2等模型实现跨模态检索

Agentic RAG：RAG与智能体深度融合

- 动态记忆管理：支持长期记忆和个性化召回
- 任务分解优化：复杂任务拆解为子查询
- 多Agent协同：跨Agent知识共享

GraphRAG：基于知识图谱的检索增强

- 动态图更新：支持实时知识更新
- 因果路径优化：提升推理准确性
- 多模态节点：支持图像、视频等信息类型

## 关于RAG和微调的选择

如果你的数据资料是文献、文档资料，那么你可以选择使用 RAG 模型，因为 RAG 模型是基于检索的生成模型，可以更好地利用文档库中的信息。

而如果你的数据资料是对话数据（QA对话），那么你可以选择使用STF微调的生成模型，因为对话数据更适合生成模型的学习方式。

> 目前LLMs应用落地实际技术：
> 1. 提示词工程
> 2. RAG
> 3. 微调
> 4. 预训练模型  
> 目前大部分实践都是前三种结合使用。

| 维度   | RAG        | 微调          |
|------|------------|-------------|
| 数据量  | 数据稀疏或无标注数据 | 数据丰富且标注质量高  |
| 时效性  | 需实时更新知识    | 知识相对稳定      |
| 任务类型 | 知识密集型问答    | 特定任务优化      |
| 成本   | 低（维护知识库）   | 高（训练资源）     |
| 灵活性  | 快速响应业务变化   | 需重新训练适应新需求  |
| 可解释性 | 答案可溯源，减少幻觉 | 黑盒模型，难以验证来源 |


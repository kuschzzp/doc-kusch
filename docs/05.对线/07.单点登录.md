---
title: 单点登录
date: 2024-03-18 15:41:52
permalink: /pages/d3759d/
categories:
  - 对线
tags:
  - 对线
author:
  name: Mr.Kusch
  link: https://github.com/kuschzzp
---

# 单点登录

## 一、为什么需要单点登录（SSO）

在互联网时代，企业往往有多个系统：

* OA 办公系统
* 邮件系统
* CRM 客户管理系统
* 财务系统

如果每个系统都要求单独登录，那么用户要：

* 重复输入账号密码；
* 管理多个密码；
* 频繁切换系统时重复认证。

**单点登录（Single Sign-On，简称 SSO）** 就是为了解决这个痛点而生的。
**一句话理解：**

> 用户只需登录一次，即可访问多个相互信任的系统。

---

## 二、SSO 的基本思路

SSO 核心目标是：
让多个系统共享同一个登录态（即「用户已登录」的状态）。

### 举个例子：

你打开公司门户网站 `portal.company.com`，输入账号密码登录。
此时你再访问 `crm.company.com`、`oa.company.com`，系统会自动识别你已登录，不需要再次输入密码。

这背后的逻辑大致如下：

---

## 三、SSO 的典型实现流程（原理图）

下面是 SSO 的**标准认证流程**：

```
+--------------------+                 +-------------------+
|  用户（浏览器）     |                 |  SSO 认证中心       |
+--------------------+                 +-------------------+
          |                                          |
          | ① 访问系统 A                              |
          |------------------------------------------>|
          |                                          |
          | ② 系统 A 检测到用户未登录，跳转 SSO 登录页  |
          |<------------------------------------------|
          |                                          |
          | ③ 用户在 SSO 登录页输入账号密码             |
          |------------------------------------------>|
          |                                          |
          | ④ 认证通过，生成登录凭证（如 Token / Ticket） |
          |<------------------------------------------|
          |                                          |
          | ⑤ 浏览器携带 Token 访问系统 A               |
          |------------------------------------------>|
          |                                          |
          | ⑥ 系统 A 向 SSO 验证 Token 有效性           |
          |------------------------------------------>|
          | ⑦ 验证通过，系统 A 创建本地会话              |
          |<------------------------------------------|
          |                                          |
          | ✅ 用户已登录系统 A                         |
          |                                          |
```

之后访问系统 B 时（如 `crm.company.com`），流程类似：

1. 系统 B 检测用户未登录；
2. 跳转到 SSO；
3. SSO 发现浏览器已经有登录状态；
4. 自动发放新的 Token 给系统 B；
5. 用户直接登录成功（无需再次输入密码）。

---

## 四、SSO 的核心组件

| 组件                     | 作用                   |
| ---------------------- | -------------------- |
| **认证中心（SSO Server）**   | 统一的登录服务，负责身份验证和发放令牌  |
| **业务系统（App / Client）** | 需要用户身份信息的各个业务模块      |
| **Token / Ticket**     | 认证中心颁发的登录凭证，用于证明用户身份 |
| **Cookie / Session**   | 浏览器端存储登录状态的机制        |

---

## 五、常见 SSO 实现方式

### 1️⃣ Cookie 域共享方案

* 同一个主域名下（如 `*.company.com`）的系统可以共享 Cookie；
* 简单但局限：跨域无法使用。

### 2️⃣ Token + SSO Server 方案（推荐）

* 所有系统通过 Token 与 SSO Server 通信；
* 可跨域、跨系统；
* 常用于现代企业级系统（如 CAS、Keycloak、Auth0 等方案）。

---

## 六、SSO 与 OAuth2 的区别

很多新手会混淆这两个概念。它们虽然都与“认证”有关，但出发点不同。

| 对比项            | **SSO（Single Sign-On）** | **OAuth2（Open Authorization）**    |
| :------------- | :---------------------- | :-------------------------------- |
| **目的**         | 用户一次登录访问多个系统            | 授权第三方访问资源（而不暴露密码）                 |
| **场景**         | 多系统共享登录状态               | 微信登录、GitHub 授权登录等                 |
| **核心参与方**      | 用户、SSO 服务端、多个业务系统       | 用户、资源拥有者、授权服务器、第三方应用              |
| **主要流程**       | 登录 → 发 Token → 业务系统验证   | 授权 → 获取 Access Token → 访问资源       |
| **是否跨系统共享登录态** | 是                       | 否（只授权访问资源）                        |
| **典型实现**       | CAS、Keycloak、企业自建认证中心   | 微信 OAuth2、GitHub OAuth2、Google 登录 |

**总结一句话区分：**

> ✅ **SSO 解决“登录一次”的问题，OAuth2 解决“授权访问”的问题。**

---

## 七、OAuth2 也能实现 SSO 吗？

可以，但需要扩展。
很多现代身份框架（如 **OpenID Connect, 简称 OIDC**）是在 OAuth2 之上扩展而来的：

* OAuth2 解决授权；
* OpenID Connect 解决身份认证；
* 两者结合后就能同时实现「登录 + 授权」功能。

所以你常见的「使用微信登录」其实是：

> OAuth2 + OpenID Connect + SSO 的综合产物。

---

## 八、总结

| 要点                       | 说明                          |
| ------------------------ | --------------------------- |
| **SSO 是为了解决多系统登录问题**     | 一次登录，多处访问                   |
| **核心机制**                 | 中央认证中心 + Token 验证           |
| **OAuth2 是授权协议，不等于 SSO** | 但可作为 SSO 的基础                |
| **现代实现方式**               | 常用 OpenID Connect 实现统一登录与授权 |
